<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.115.1"><title>2025 05 07 關注點分離應用筆記 &#183; The Mark Chang Life</title><meta name=description content><meta itemprop=name content="2025 05 07 關注點分離應用筆記"><meta itemprop=description content="✅ 關注點分離 SOP（適用於所有後端應用） 步驟一：先問自己「這段邏輯在做什麼？」 這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：
類型 說明 對應層 流程控制 調用哪些動作、順序、條件 Main、JobTask、Controller 商業邏輯 怎麼處理資料、去重、合併、轉換 Service 資料存取 跟 DB、FTP、API 的溝通 Repository 展示與匯出 Excel、CSV、HTML 回傳等 ExportService / ViewModel 工具與共用功能 清文字、計算欄位、轉格式 Helper 或 Utils 📌 技巧 I/O 關注點：看到 SqlConnection、File."><meta itemprop=datePublished content="2025-05-07T20:06:29+08:00"><meta itemprop=dateModified content="2025-05-07T20:06:29+08:00"><meta itemprop=wordCount content="250"><meta itemprop=keywords content="筆記,"><meta name=twitter:card content="summary"><meta name=twitter:title content="2025 05 07 關注點分離應用筆記"><meta name=twitter:description content="✅ 關注點分離 SOP（適用於所有後端應用） 步驟一：先問自己「這段邏輯在做什麼？」 這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：
類型 說明 對應層 流程控制 調用哪些動作、順序、條件 Main、JobTask、Controller 商業邏輯 怎麼處理資料、去重、合併、轉換 Service 資料存取 跟 DB、FTP、API 的溝通 Repository 展示與匯出 Excel、CSV、HTML 回傳等 ExportService / ViewModel 工具與共用功能 清文字、計算欄位、轉格式 Helper 或 Utils 📌 技巧 I/O 關注點：看到 SqlConnection、File."><meta property="og:title" content="2025 05 07 關注點分離應用筆記"><meta property="og:description" content="✅ 關注點分離 SOP（適用於所有後端應用） 步驟一：先問自己「這段邏輯在做什麼？」 這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：
類型 說明 對應層 流程控制 調用哪些動作、順序、條件 Main、JobTask、Controller 商業邏輯 怎麼處理資料、去重、合併、轉換 Service 資料存取 跟 DB、FTP、API 的溝通 Repository 展示與匯出 Excel、CSV、HTML 回傳等 ExportService / ViewModel 工具與共用功能 清文字、計算欄位、轉格式 Helper 或 Utils 📌 技巧 I/O 關注點：看到 SqlConnection、File."><meta property="og:type" content="article"><meta property="og:url" content="https://cchmark.github.io/posts/2025-05-07-post/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-07T20:06:29+08:00"><meta property="article:modified_time" content="2025-05-07T20:06:29+08:00"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://cchmark.github.io#author","name":"Mark_Chang","image":{"@type":"ImageObject","url":"https://cchmark.github.io/images/black.jpg"},"description":"learn by doing, and by falling over."},{"@type":"WebSite","@id":"https://cchmark.github.io#website","url":"https://cchmark.github.io","name":"The Mark Chang Life","description":"learn by doing, and by falling over.","publisher":{"@id":"https://cchmark.github.io#author"},"inLanguage":"en"},{"@type":"WebPage","@id":"https://cchmark.github.io/posts/2025-05-07-post/#webpage","url":"https://cchmark.github.io/posts/2025-05-07-post/","name":"2025 05 07 關注點分離應用筆記","isPartOf":{"@id":"https://cchmark.github.io#website"},"about":{"@id":"https://cchmark.github.io#author"},"datePublished":"2025-05-07T20:06:29+08:00","dateModified":"2025-05-07T20:06:29+08:00","description":"✅ 關注點分離 SOP（適用於所有後端應用） 步驟一：先問自己「這段邏輯在做什麼？」 這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：\n類型 說明 對應層 流程控制 調用哪些動作、順序、條件 Main、JobTask、Controller 商業邏輯 怎麼處理資料、去重、合併、轉換 Service 資料存取 跟 DB、FTP、API 的溝通 Repository 展示與匯出 Excel、CSV、HTML 回傳等 ExportService / ViewModel 工具與共用功能 清文字、計算欄位、轉格式 Helper 或 Utils 📌 技巧 I/O 關注點：看到 SqlConnection、File.","inLanguage":"en","potentialAction":[{"@type":"ReadAction","target":["https://cchmark.github.io/posts/2025-05-07-post/"]}]},{"@type":"Article","isPartOf":{"@id":"https://cchmark.github.io/posts/2025-05-07-post/#webpage"},"mainEntityOfPage":{"@id":"https://cchmark.github.io/posts/2025-05-07-post/#webpage"},"headline":"2025 05 07 關注點分離應用筆記","datePublished":"2025-05-07T20:06:29+08:00","dateModified":"2025-05-07T20:06:29+08:00","publisher":{"@id":"https://cchmark.github.io#author"},"keywords":["筆記"],"articleSection":["筆記"],"inLanguage":"en","author":{"@type":"Person","name":null},"potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://cchmark.github.io/posts/2025-05-07-post/#comments"]}]}]}</script><link type=text/css rel=stylesheet href=/css/print.css media=print><link type=text/css rel=stylesheet href=/css/poole.css><link type=text/css rel=stylesheet href=/css/hyde.css><link type=text/css rel=stylesheet href=/css/hyde.css><link rel=preload as=style href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Roboto:400,700&display=swap" onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Roboto:400,700&display=swap"></noscript><link rel=preload as=style href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css></noscript><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class=container><div class=sidebar-about><div class=author-image><a href=https://cchmark.github.io><img src=/images/black.jpg class="img-circle img-headshot center" alt="Profile Picture" loading=lazy></a></div><h1>The Mark Chang Life</h1><p class=lead>learn by doing, and by falling over.</p></div><nav><ul class=sidebar-nav><li><a href=https://cchmark.github.io>Home</a></li><li><a href=/archives/>Archives</a></li><li><a href=/about/>About</a></li></ul></nav><section class=social-icons><a href=# rel=me title=Linkedin target=_blank><i class="fab fa-linkedin" aria-hidden=true></i></a>
<a href=https://github.com/CchMark rel=me title=GitHub target=_blank><i class="fab fa-github" aria-hidden=true></i></a>
<a href=# rel=me title=Twitter target=_blank><i class="fab fa-twitter" aria-hidden=true></i></a>
<a href=mailto:markchangstart2022@gmail.com rel=me title=E-Mail target=_blank><i class="fab fas fa-envelope" aria-hidden=true></i></a></section></div></aside><main class="content container"><div class=post><h1 class=title>2025 05 07 關注點分離應用筆記</h1><div class=post-date><time datetime=2025-05-07T20:06:29+0800>May 7, 2025</time> <span class=readtime>&#183; 2 min read</span></div><div><h2 id=-關注點分離-sop適用於所有後端應用>✅ 關注點分離 SOP（適用於所有後端應用）</h2><h3 id=步驟一先問自己這段邏輯在做什麼>步驟一：先問自己「這段邏輯在做什麼？」</h3><p>這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：</p><table><thead><tr><th>類型</th><th>說明</th><th>對應層</th></tr></thead><tbody><tr><td><strong>流程控制</strong></td><td>調用哪些動作、順序、條件</td><td>Main、JobTask、Controller</td></tr><tr><td><strong>商業邏輯</strong></td><td>怎麼處理資料、去重、合併、轉換</td><td>Service</td></tr><tr><td><strong>資料存取</strong></td><td>跟 DB、FTP、API 的溝通</td><td>Repository</td></tr><tr><td><strong>展示與匯出</strong></td><td>Excel、CSV、HTML 回傳等</td><td>ExportService / ViewModel</td></tr><tr><td><strong>工具與共用功能</strong></td><td>清文字、計算欄位、轉格式</td><td>Helper 或 Utils</td></tr></tbody></table><h4 id=-技巧>📌 技巧</h4><ul><li><strong>I/O 關注點</strong>：看到 <code>SqlConnection</code>、<code>File.WriteAllText</code>、<code>client.Send()</code> → 放 <code>Repository</code> 或 <code>ExportService</code>。</li><li><strong>資料邏輯</strong>：看到 <code>GroupBy</code>、<code>Select</code>、<code>Join</code> → 放 <code>Service</code>。</li><li><strong>流程控制</strong>：看到 <code>Execute()</code>、<code>Run()</code>、<code>DoSync()</code> → 放 <code>Task</code>。</li></ul><hr><h3 id=步驟二拆分責任--放進專屬模組>步驟二：拆分責任 → 放進專屬模組</h3><table><thead><tr><th>責任</th><th>範例判斷語句</th><th>該放哪裡</th></tr></thead><tbody><tr><td><strong>處理流程</strong></td><td><code>task.Execute()</code> / <code>controller.Post()</code></td><td>JobTask / Controller</td></tr><tr><td><strong>查資料表</strong></td><td><code>SELECT * FROM ...</code> / <code>Query&lt;T>()</code></td><td>Repository</td></tr><tr><td><strong>商業判斷</strong></td><td><code>if (data.Count > 0)</code> / <code>join/group</code></td><td>Service</td></tr><tr><td><strong>格式轉換</strong></td><td><code>string.Join()</code> / <code>Regex.Replace</code></td><td>Helper</td></tr><tr><td><strong>匯出 Excel</strong></td><td><code>ExcelPackage.SaveAs()</code></td><td>ExportService</td></tr></tbody></table><hr><h3 id=步驟三讓流程呼叫服務呼叫存取>步驟三：讓「流程」呼叫「服務」呼叫「存取」</h3><h4 id=-錯誤寫法>❌ 錯誤寫法：</h4><p>流程直接開 <code>SqlConnection</code> 撈資料 + 做邏輯 + 輸出 Excel。</p><h4 id=-正確拆分>✅ 正確拆分：</h4><p><code>Main/JobTask --> ProductService --> ProductRepository --> ExportService</code></p><hr><h3 id=步驟四命名要幫助自我定位>步驟四：命名要幫助「自我定位」</h3><ul><li><strong>XXXRepository</strong> → 一看就知道是 DB 操作。</li><li><strong>XXXService</strong> → 專注做資料處理與流程規則。</li><li><strong>XXXDto</strong> → 是資料傳輸用，沒有行為邏輯。</li><li><strong>XXXHelper</strong> → 是工具，不依賴資料流程狀態。</li></ul><h4 id=-懶人技巧>🎯 懶人技巧</h4><p>問自己：「我以後會不會想單獨重用這段？測試它？單獨換資料來源？」</p><ul><li>如果會，那就應該把它拆到獨立模組（Repository、Service、Export&mldr;）。</li></ul><hr><h2 id=-最常用-4-層簡易對照表給你每次做-job-時參考>📌 最常用 4 層簡易對照表（給你每次做 Job 時參考）</h2><table><thead><tr><th>層級</th><th>功能描述</th><th>範例類別</th></tr></thead><tbody><tr><td><strong>UI/流程層</strong></td><td>控制執行順序、處理輸入參數</td><td>Main、ProductMainTask</td></tr><tr><td><strong>Service層</strong></td><td>處理商業邏輯、資料合併、判斷邏輯</td><td>ProductService, SyncService</td></tr><tr><td><strong>Repository層</strong></td><td>撈資料、存資料</td><td>ProductRepository</td></tr><tr><td><strong>Output層</strong></td><td>匯出 Excel/檔案、推送外部服務</td><td>ExportService, ApiPoster</td></tr></tbody></table><hr><h2 id=架構圖關注點分離的分層設計>架構圖：關注點分離的分層設計</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ProductJob/
</span></span><span style=display:flex><span>├── Program.cs ← Job 入口點，啟動整個流程
</span></span><span style=display:flex><span>├── AppCode/
</span></span><span style=display:flex><span>│   └── ProductMainTask.cs ← 控制整體流程的主控類別
</span></span><span style=display:flex><span>├── Services/ ← 商業邏輯與流程處理
</span></span><span style=display:flex><span>│   └── ProductService.cs
</span></span><span style=display:flex><span>├── Repositories/ ← 資料存取層 (Dapper SQL)
</span></span><span style=display:flex><span>│   ├── ProductRepository.cs
</span></span><span style=display:flex><span>│   └── ItemRepository.cs
</span></span><span style=display:flex><span>├── Export/ ← 資料匯出處理
</span></span><span style=display:flex><span>│   └── ExportService.cs
</span></span><span style=display:flex><span>├── DTOs/ ← 資料傳輸物件
</span></span><span style=display:flex><span>│   └── ProductMainDto.cs
</span></span><span style=display:flex><span>└── Mapping/ ← AutoMapper 設定
</span></span><span style=display:flex><span>    └── MappingProfile.cs
</span></span></code></pre></div><hr><h2 id=-詳細解說關注點分離的思考方式>🔍 詳細解說：關注點分離的思考方式</h2><h3 id=1-programcs啟動層>1. <strong>Program.cs（啟動層）</strong></h3><ul><li><strong>責任</strong>：作為應用程式的入口點，負責初始化必要的服務和啟動主流程。</li><li><strong>為何分離</strong>：保持啟動邏輯的簡潔，避免混入業務邏輯，方便日後的測試和維護。</li></ul><h3 id=2-appcodeproductmaintaskcs流程控制層>2. <strong>AppCode/ProductMainTask.cs（流程控制層）</strong></h3><ul><li><strong>責任</strong>：控制整個資料同步的流程，調用各個服務完成特定任務。</li><li><strong>為何分離</strong>：將流程控制與具體的業務邏輯分離，使流程更清晰，業務邏輯更專注。</li></ul><h3 id=3-servicesproductservicecs商業邏輯層>3. <strong>Services/ProductService.cs（商業邏輯層）</strong></h3><ul><li><strong>責任</strong>：實現具體的業務邏輯，如資料的合併、去重等。</li><li><strong>為何分離</strong>：將業務邏輯集中管理，便於測試和重用，並與資料存取和流程控制分離。</li></ul><h3 id=4-repositories資料存取層>4. <strong>Repositories/（資料存取層）</strong></h3><ul><li><strong>責任</strong>：負責與資料庫的互動，執行 SQL 查詢和命令。</li><li><strong>為何分離</strong>：將資料存取與業務邏輯分離，便於管理資料存取的變更，並提高測試的靈活性。</li></ul><h3 id=5-exportexportservicecs匯出層>5. <strong>Export/ExportService.cs（匯出層）</strong></h3><ul><li><strong>責任</strong>：處理資料的匯出功能，如將資料匯出為 Excel 檔案。</li><li><strong>為何分離</strong>：將匯出功能獨立，便於重用和維護，並與業務邏輯和流程控制分離。</li></ul><h3 id=6-dtos資料傳輸物件>6. <strong>DTOs/（資料傳輸物件）</strong></h3><ul><li><strong>責任</strong>：定義資料在不同層級之間傳遞的結構。</li><li><strong>為何分離</strong>：明確資料的結構和格式，便於資料的轉換和驗證。</li></ul><h3 id=7-mappingmappingprofilecs映射設定>7. <strong>Mapping/MappingProfile.cs（映射設定）</strong></h3><ul><li><strong>責任</strong>：設定 AutoMapper 的映射規則，將不同的資料模型轉換為 DTO。</li><li><strong>為何分離</strong>：集中管理映射設定，便於維護和擴展。</li></ul><hr><h2 id=-如何應用關注點分離的思維>🧠 如何應用關注點分離的思維</h2><ol><li><strong>識別不同的責任</strong>：分析程式碼中不同的功能和責任，將其劃分為不同的模組或層級。</li><li><strong>定義清晰的介面</strong>：為每個模組定義清晰的介面，確保模組之間的互動簡潔明確。</li><li><strong>保持模組的獨立性</strong>：確保每個模組專注於其特定的責任，避免模組之間的過度耦合。</li><li><strong>便於測試和維護</strong>：透過分離的模組設計，使得每個模組可以獨立測試和維護，提高整體系統的穩定性和可擴展性。</li></ol></div><div><ul class=tags><li><a href=https://cchmark.github.io/tags/%E7%AD%86%E8%A8%98/ class=tag-link>筆記</a></li></ul></div><div class=share-buttons><a class=mail-share-button href=mailto:markchangstart2022@gmail.com title="Share on EMail"><i class="fas fa-envelope"></i></a></div><script>function payBlock(){let e=document.getElementById("pay");e.style.height=="0px"?e.style.height="360px":e.style.height="0px"}</script><div style=color:red;text-align:center;cursor:pointer;text-decoration:underline;font-size:24px onclick=payBlock()>如果喜歡可以請我喝杯咖啡，這樣我會更有動力唷XDD</div><div id=pay style="margin-top:20px;text-align:center;overflow:hidden;height:0;transition:height .5s ease 0s"><div style=display:inline-block;width:200px><img src=/images/jkosPay.jpg border=0 alt=街口支付 loading=lazy><p style=font-size:20px>街口支付</p><p>街口帳號: 901526306</p></div></div><br></br><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://https-cchmark-github-io-1.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer><div><p>&copy; Mark_Chang All rights reserved. 2025
<span id=busuanzi_container_site_uv>總瀏覽<span id=busuanzi_value_site_uv></span>次</span></p></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0=" crossorigin=anonymous></script>
<script src=/js/jquery.min.js></script>
<script src=/js/soho.js></script>
<script src=/js/theme-toggle.js></script>
<script src=/js/soho.js></script></body></html>