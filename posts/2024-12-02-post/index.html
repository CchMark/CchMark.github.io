<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.115.1"><title>2025 05 07 關注點分離應用筆記 &#183; The Mark Chang Life</title><meta name=description content><meta itemprop=name content="2025 05 07 關注點分離應用筆記"><meta itemprop=description content="✅ 關注點分離 SOP（適用於所有後端應用） 步驟一：先問自己「這段邏輯在做什麼？」 這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：
類型	說明	對應層 流程控制	調用哪些動作、順序、條件	Main、JobTask、Controller 商業邏輯	怎麼處理資料、去重、合併、轉換	Service 資料存取	跟 DB、FTP、API 的溝通	Repository 展示與匯出	Excel、CSV、HTML 回傳等	ExportService / ViewModel 工具與共用功能	清文字、計算欄位、轉格式	Helper 或 Utils"><meta itemprop=datePublished content="2025-05-07T20:06:29+08:00"><meta itemprop=dateModified content="2025-05-07T20:06:29+08:00"><meta itemprop=wordCount content="257"><meta itemprop=keywords content="筆記,"><meta name=twitter:card content="summary"><meta name=twitter:title content="2025 05 07 關注點分離應用筆記"><meta name=twitter:description content="✅ 關注點分離 SOP（適用於所有後端應用） 步驟一：先問自己「這段邏輯在做什麼？」 這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：
類型	說明	對應層 流程控制	調用哪些動作、順序、條件	Main、JobTask、Controller 商業邏輯	怎麼處理資料、去重、合併、轉換	Service 資料存取	跟 DB、FTP、API 的溝通	Repository 展示與匯出	Excel、CSV、HTML 回傳等	ExportService / ViewModel 工具與共用功能	清文字、計算欄位、轉格式	Helper 或 Utils"><meta property="og:title" content="2025 05 07 關注點分離應用筆記"><meta property="og:description" content="✅ 關注點分離 SOP（適用於所有後端應用） 步驟一：先問自己「這段邏輯在做什麼？」 這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：
類型	說明	對應層 流程控制	調用哪些動作、順序、條件	Main、JobTask、Controller 商業邏輯	怎麼處理資料、去重、合併、轉換	Service 資料存取	跟 DB、FTP、API 的溝通	Repository 展示與匯出	Excel、CSV、HTML 回傳等	ExportService / ViewModel 工具與共用功能	清文字、計算欄位、轉格式	Helper 或 Utils"><meta property="og:type" content="article"><meta property="og:url" content="https://cchmark.github.io/posts/2024-12-02-post/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-07T20:06:29+08:00"><meta property="article:modified_time" content="2025-05-07T20:06:29+08:00"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://cchmark.github.io#author","name":"Mark_Chang","image":{"@type":"ImageObject","url":"https://cchmark.github.io/images/black.jpg"},"description":"learn by doing, and by falling over."},{"@type":"WebSite","@id":"https://cchmark.github.io#website","url":"https://cchmark.github.io","name":"The Mark Chang Life","description":"learn by doing, and by falling over.","publisher":{"@id":"https://cchmark.github.io#author"},"inLanguage":"en"},{"@type":"WebPage","@id":"https://cchmark.github.io/posts/2024-12-02-post/#webpage","url":"https://cchmark.github.io/posts/2024-12-02-post/","name":"2025 05 07 關注點分離應用筆記","isPartOf":{"@id":"https://cchmark.github.io#website"},"about":{"@id":"https://cchmark.github.io#author"},"datePublished":"2025-05-07T20:06:29+08:00","dateModified":"2025-05-07T20:06:29+08:00","description":"✅ 關注點分離 SOP（適用於所有後端應用） 步驟一：先問自己「這段邏輯在做什麼？」 這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：\n類型\t說明\t對應層 流程控制\t調用哪些動作、順序、條件\tMain、JobTask、Controller 商業邏輯\t怎麼處理資料、去重、合併、轉換\tService 資料存取\t跟 DB、FTP、API 的溝通\tRepository 展示與匯出\tExcel、CSV、HTML 回傳等\tExportService / ViewModel 工具與共用功能\t清文字、計算欄位、轉格式\tHelper 或 Utils","inLanguage":"en","potentialAction":[{"@type":"ReadAction","target":["https://cchmark.github.io/posts/2024-12-02-post/"]}]},{"@type":"Article","isPartOf":{"@id":"https://cchmark.github.io/posts/2024-12-02-post/#webpage"},"mainEntityOfPage":{"@id":"https://cchmark.github.io/posts/2024-12-02-post/#webpage"},"headline":"2025 05 07 關注點分離應用筆記","datePublished":"2025-05-07T20:06:29+08:00","dateModified":"2025-05-07T20:06:29+08:00","publisher":{"@id":"https://cchmark.github.io#author"},"keywords":["筆記"],"articleSection":["筆記"],"inLanguage":"en","author":{"@type":"Person","name":null},"potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://cchmark.github.io/posts/2024-12-02-post/#comments"]}]}]}</script><link type=text/css rel=stylesheet href=/css/print.css media=print><link type=text/css rel=stylesheet href=/css/poole.css><link type=text/css rel=stylesheet href=/css/hyde.css><link type=text/css rel=stylesheet href=/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin=anonymous><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class=container><div class=sidebar-about><div class=author-image><a href=https://cchmark.github.io><img src=/images/black.jpg class="img-circle img-headshot center" alt="Profile Picture"></a></div><h1>The Mark Chang Life</h1><p class=lead>learn by doing, and by falling over.</p></div><nav><ul class=sidebar-nav><li><a href=https://cchmark.github.io>Home</a></li><li><a href=/archives/>Archives</a></li><li><a href=/about/>About</a></li></ul></nav><section class=social-icons><a href=# rel=me title=Linkedin target=_blank><i class="fab fa-linkedin" aria-hidden=true></i></a>
<a href=https://github.com/CchMark rel=me title=GitHub target=_blank><i class="fab fa-github" aria-hidden=true></i></a>
<a href=# rel=me title=Twitter target=_blank><i class="fab fa-twitter" aria-hidden=true></i></a>
<a href=mailto:markchangstart2022@gmail.com rel=me title=E-Mail target=_blank><i class="fab fas fa-envelope" aria-hidden=true></i></a></section></div></aside><main class="content container"><div class=post><h1 class=title>2025 05 07 關注點分離應用筆記</h1><div class=post-date><time datetime=2025-05-07T20:06:29+0800>May 7, 2025</time> <span class=readtime>&#183; 2 min read</span></div><div><p>✅ 關注點分離 SOP（適用於所有後端應用）
步驟一：先問自己「這段邏輯在做什麼？」
這是核心判斷點。你會發現大多數邏輯屬於以下 3 種責任之一：</p><p>類型 說明 對應層
流程控制 調用哪些動作、順序、條件 Main、JobTask、Controller
商業邏輯 怎麼處理資料、去重、合併、轉換 Service
資料存取 跟 DB、FTP、API 的溝通 Repository
展示與匯出 Excel、CSV、HTML 回傳等 ExportService / ViewModel
工具與共用功能 清文字、計算欄位、轉格式 Helper 或 Utils</p><p>📌 技巧：只要你看到 SqlConnection、File.WriteAllText、client.Send()，這就是「I/O 關注點」→ 要放 Repository 或 ExportService。
看到 GroupBy、Select、Join → 「資料邏輯」→ 放 Service。
看到 Execute(), Run(), DoSync() → 「流程控制」→ 放 Task。</p><p>步驟二：拆分責任 → 放進專屬模組
📌 模組放法可以對應成下面這樣：</p><p>責任 範例判斷語句 該放哪裡
處理流程 task.Execute() / controller.Post() JobTask / Controller
查資料表 SELECT * FROM &mldr; / Query<t>() Repository
商業判斷 if (data.Count > 0) / join/group Service
格式轉換 string.Join() / Regex.Replace Helper
匯出 Excel ExcelPackage.SaveAs() ExportService</p><p>步驟三：讓「流程」呼叫「服務」呼叫「存取」</p><p>❌ 錯誤寫法：
流程直接開 SqlConnection 撈資料 + 做邏輯 + 輸出 Excel</p><p>✅ 正確拆分：
Main/JobTask &ndash;> ProductService &ndash;> ProductRepository &ndash;> ExportService</p><p>步驟四：命名要幫助「自我定位」
📌 XXXRepository → 一看就知道是 DB 操作</p><p>📌 XXXService → 專注做資料處理與流程規則</p><p>📌 XXXDto → 是資料傳輸用，沒有行為邏輯</p><p>📌 XXXHelper → 是工具，不依賴資料流程狀態</p><p>🎯 懶人技巧：反問自己
問自己：「我以後會不會想單獨重用這段？測試它？單獨換資料來源？」</p><p>如果會，那就應該把它拆到獨立模組（Repository、Service、Export&mldr;）</p><p>📌 最常用 4 層簡易對照表（給你每次做 Job 時參考）
層級 功能描述 範例類別
UI/流程層 控制執行順序、處理輸入參數 Main、MTKProductMainTask
Service層 處理商業邏輯、資料合併、判斷邏輯 ProductService, SyncService
Repository層 撈資料、存資料 ProductRepository
Output層 匯出 Excel/檔案、推送外部服務 ExportService, ApiPoster</p><p>架構圖：關注點分離的分層設計</p><p>MKTProductJob/
├── Program.cs ← Job 入口點，啟動整個流程
├── AppCode/
│ └── MTKProductMainTask.cs ← 控制整體流程的主控類別
├── Services/ ← 商業邏輯與流程處理
│ └── ProductService.cs
├── Repositories/ ← 資料存取層（Dapper SQL）
│ ├── ProductRepository.cs
│ └── ItemRepository.cs
├── Export/ ← 資料匯出處理
│ └── ExportService.cs
├── DTOs/ ← 資料傳輸物件
│ └── ProductMainDto.cs
├── Mapping/ ← AutoMapper 設定
│ └── MappingProfile.cs</p><p>🔍 詳細解說：關注點分離的思考方式
關注點分離（Separation of Concerns, SoC）是一種設計原則，旨在將程式碼分成不同的模組或層級，每個模組或層級專注於特定的功能或責任。這樣的設計有助於提高程式碼的可讀性、可維護性和可重用性。</p><p>以下是各個層級的詳細說明：</p><ol><li>Program.cs（啟動層）
責任：作為應用程式的入口點，負責初始化必要的服務和啟動主流程。</li></ol><p>為何分離：保持啟動邏輯的簡潔，避免混入業務邏輯，方便日後的測試和維護。</p><ol start=2><li>AppCode/MTKProductMainTask.cs（流程控制層）
責任：控制整個資料同步的流程，調用各個服務完成特定任務。</li></ol><p>為何分離：將流程控制與具體的業務邏輯分離，使流程更清晰，業務邏輯更專注。</p><ol start=3><li>Services/ProductService.cs（商業邏輯層）
責任：實現具體的業務邏輯，如資料的合併、去重等。</li></ol><p>為何分離：將業務邏輯集中管理，便於測試和重用，並與資料存取和流程控制分離。</p><ol start=4><li>Repositories/（資料存取層）
責任：負責與資料庫的互動，執行 SQL 查詢和命令。</li></ol><p>為何分離：將資料存取與業務邏輯分離，便於管理資料存取的變更，並提高測試的靈活性。</p><ol start=5><li>Export/ExportService.cs（匯出層）
責任：處理資料的匯出功能，如將資料匯出為 Excel 檔案。</li></ol><p>為何分離：將匯出功能獨立，便於重用和維護，並與業務邏輯和流程控制分離。</p><ol start=6><li>DTOs/（資料傳輸物件）
責任：定義資料在不同層級之間傳遞的結構。</li></ol><p>為何分離：明確資料的結構和格式，便於資料的轉換和驗證。</p><ol start=7><li>Mapping/MappingProfile.cs（映射設定）
責任：設定 AutoMapper 的映射規則，將不同的資料模型轉換為 DTO。</li></ol><p>為何分離：集中管理映射設定，便於維護和擴展。
重編國語辭典修訂本</p><p>🧠 如何應用關注點分離的思維
識別不同的責任：分析程式碼中不同的功能和責任，將其劃分為不同的模組或層級。</p><p>定義清晰的介面：為每個模組定義清晰的介面，確保模組之間的互動簡潔明確。</p><p>保持模組的獨立性：確保每個模組專注於其特定的責任，避免模組之間的過度耦合。</p><p>便於測試和維護：透過分離的模組設計，使得每個模組可以獨立測試和維護，提高整體系統的穩定性和可擴展性。</p></div><div><ul class=tags><li><a href=https://cchmark.github.io/tags/%E7%AD%86%E8%A8%98/ class=tag-link>筆記</a></li></ul></div><div class=share-buttons><a class=mail-share-button href=mailto:markchangstart2022@gmail.com title="Share on EMail"><i class="fas fa-envelope"></i></a></div><script>function payBlock(){let e=document.getElementById("pay");e.style.height=="0px"?e.style.height="360px":e.style.height="0px"}</script><div style=color:red;text-align:center;cursor:pointer;text-decoration:underline;font-size:24px onclick=payBlock()>如果喜歡可以請我喝杯咖啡，這樣我會更有動力唷XDD</div><div id=pay style="margin-top:20px;text-align:center;overflow:hidden;height:0;transition:height .5s ease 0s"><div style=display:inline-block;width:200px><img src=/images/jkosPay.jpg border=0 alt=街口支付><p style=font-size:20px>街口支付</p><p>街口帳號: 901526306</p></div></div><br></br><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://https-cchmark-github-io-1.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer><div><p>&copy; Mark_Chang All rights reserved. 2025
<span id=busuanzi_container_site_uv>總瀏覽<span id=busuanzi_value_site_uv></span>次</span></p></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0=" crossorigin=anonymous></script>
<script src=/js/jquery.min.js></script>
<script src=/js/soho.js></script>
<script src=/js/soho.js></script></body></html>